<!DOCTYPE html>
<html lang="ar" dir="rtl" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© - Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&family=Almarai:wght@300;400;700;800&display=swap" rel="stylesheet">
  
  <style>
    * { font-family: 'Almarai', 'Tajawal', sans-serif; }
    body { background: linear-gradient(135deg, #f0fdf4 0%, #e0f2fe 100%); min-height: 100vh; }
    .glass-card { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.6); }
    .input-field { width: 100%; padding: 1rem 1rem 1rem 3rem; border: 2px solid #e5e7eb; border-radius: 1rem; }
    .input-field:focus { border-color: #10b981; box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1); outline: none; }
  </style>
</head>
<body class="antialiased">

<main class="min-h-screen py-6 px-4 flex justify-center">
  <div class="w-full max-w-3xl">
    
    <header class="text-center mb-10">
      <h1 class="text-4xl font-black text-gray-800 mb-2">Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</h1>
      <p class="text-lg text-gray-600">Ø¨ÙŠØ¦Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© ØªÙØ§Ø¹Ù„ÙŠØ©</p>
    </header>

    <!-- Ø²Ø± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹ -->
    <div class="mb-6">
      <button onclick="testScript()" class="bg-blue-500 text-white px-6 py-3 rounded-xl font-bold mb-4">
        ğŸ”§ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙƒØ±Ø¨ÙŠØª
      </button>
      <div id="test-result" class="glass-card p-4 rounded-xl text-sm"></div>
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ù…Ø¨Ø³Ø· Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± -->
    <div id="form-container">
      <form id="join-form" class="glass-card rounded-3xl p-6 space-y-5">
        
        <div>
          <label class="block text-sm font-bold text-gray-700 mb-1.5">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ</label>
          <input type="text" id="name" required class="input-field" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ù‡Ù†Ø§...">
        </div>

        <div>
          <label class="block text-sm font-bold text-gray-700 mb-1.5">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
          <input type="email" id="email" required class="input-field" placeholder="name@example.com">
        </div>

        <div>
          <label class="block text-sm font-bold text-gray-700 mb-1.5">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
          <input type="tel" id="phone" required pattern="[0-9]{8}" class="input-field" placeholder="9XXXXXXX">
        </div>

        <button type="submit" id="submit-btn" class="bg-green-500 text-white w-full py-4 rounded-xl font-bold text-lg">
          Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…
        </button>
      </form>
    </div>

    <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¨Ø³Ø·Ø© -->
    <footer class="mt-10 text-center">
      <button onclick="openSimpleAdmin()" class="bg-gray-800 text-white px-4 py-2 rounded-full">
        ğŸ” Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†
      </button>
    </footer>

  </div>
</main>

<!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ† Ø§Ù„Ù…Ø¨Ø³Ø·Ø© -->
<div id="simple-admin" class="hidden fixed inset-0 bg-slate-900 p-4 z-50 overflow-auto">
  <div class="max-w-4xl mx-auto">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-bold text-white">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
      <button onclick="closeSimpleAdmin()" class="bg-red-500 text-white px-4 py-2 rounded-lg">âœ• Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="bg-slate-800 p-4 rounded-xl">
        <h3 class="text-white font-bold mb-2">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</h3>
        <button onclick="testGetAll()" class="bg-blue-500 text-white px-4 py-2 rounded-lg w-full mb-2">
          Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        </button>
        <div id="getall-result" class="text-white text-sm mt-2"></div>
      </div>
      
      <div class="bg-slate-800 p-4 rounded-xl">
        <h3 class="text-white font-bold mb-2">Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
        <div id="records-list" class="text-white text-sm"></div>
      </div>
    </div>
    
    <div class="mt-6 bg-slate-800 p-4 rounded-xl">
      <h3 class="text-white font-bold mb-2">ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</h3>
      <div id="debug-info" class="text-yellow-300 text-sm font-mono"></div>
    </div>
  </div>
</div>

<script>
// ============================================
// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„
// ============================================
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwBPFWhdR1r1T78ozhHem-rBg3L0zRU7XRTqZ8zZbVMZzGacPadTeS6S-PBf0d7DhFX/exec';

// ============================================
// Ø¯Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„
// ============================================
async function testScript() {
  const resultDiv = document.getElementById('test-result');
  resultDiv.innerHTML = '<div class="text-blue-500">â³ Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„...</div>';
  
  try {
    const response = await fetch(`${SCRIPT_URL}?action=test&t=${Date.now()}`);
    const data = await response.json();
    
    resultDiv.innerHTML = `
      <div class="text-green-600 font-bold">âœ… Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­!</div>
      <div class="text-gray-600 mt-2">
        <p>Ø§Ù„Ø­Ø§Ù„Ø©: ${data.status}</p>
        <p>Ø§Ù„Ø±Ø³Ø§Ù„Ø©: ${data.message}</p>
        <p>Ø§Ù„ÙˆÙ‚Øª: ${data.timestamp}</p>
      </div>
    `;
    
    console.log('ğŸ“¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„:', data);
    return true;
    
  } catch (error) {
    resultDiv.innerHTML = `
      <div class="text-red-600 font-bold">âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„!</div>
      <div class="text-gray-600 mt-2">
        <p>Ø§Ù„Ø®Ø·Ø£: ${error.message}</p>
        <p>ØªØ­Ù‚Ù‚ Ù…Ù†:</p>
        <ol class="list-decimal pr-4 mt-2">
          <li>ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ø³ÙƒØ±Ø¨ÙŠØª Ù…Ù†Ø´ÙˆØ± ÙƒÙ€ "Anyone, even anonymous"</li>
          <li>ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­</li>
          <li>Ø§ÙØªØ­ Console (F12) Ù„Ø±Ø¤ÙŠØ© Ø§Ù„ØªÙØ§ØµÙŠÙ„</li>
        </ol>
      </div>
    `;
    
    console.error('âŒ Ø®Ø·Ø£ Ø§Ù„Ø§ØªØµØ§Ù„:', error);
    return false;
  }
}

// ============================================
// Ù…Ø¹Ø§Ù„Ø¬Ø© Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
// ============================================
document.getElementById('join-form').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  const submitBtn = document.getElementById('submit-btn');
  const originalText = submitBtn.textContent;
  submitBtn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
  submitBtn.disabled = true;
  
  const data = {
    action: 'create',
    name: document.getElementById('name').value,
    email: document.getElementById('email').value,
    phone: document.getElementById('phone').value,
    governorate: 'Ù…Ø³Ù‚Ø·',
    wilayat: 'Ø§Ù„Ø³ÙŠØ¨',
    school: 'Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±',
    submitted_at: new Date().toISOString()
  };
  
  console.log('ğŸ“¤ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©:', data);
  
  try {
    const response = await fetch(SCRIPT_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'text/plain;charset=utf-8'
      },
      body: JSON.stringify(data)
    });
    
    const result = await response.json();
    console.log('ğŸ“¥ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©:', result);
    
    if (result.status === 'success') {
      alert('ğŸ‰ ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!');
      document.getElementById('join-form').reset();
    } else {
      alert(`âŒ Ø®Ø·Ø£: ${result.message}`);
    }
    
  } catch (error) {
    console.error('âŒ Ø®Ø·Ø£ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„:', error);
    alert('âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…ØŒ ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆÙ†Ø³ÙˆÙ„ (F12)');
  } finally {
    submitBtn.textContent = originalText;
    submitBtn.disabled = false;
  }
});

// ============================================
// Ø¯Ø§Ù„Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ† Ø§Ù„Ù…Ø¨Ø³Ø·Ø©
// ============================================
function openSimpleAdmin() {
  document.getElementById('simple-admin').classList.remove('hidden');
  document.body.style.overflow = 'hidden';
}

function closeSimpleAdmin() {
  document.getElementById('simple-admin').classList.add('hidden');
  document.body.style.overflow = 'auto';
}

async function testGetAll() {
  const resultDiv = document.getElementById('getall-result');
  resultDiv.innerHTML = '<div class="text-blue-500">â³ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>';
  
  try {
    const response = await fetch(`${SCRIPT_URL}?action=getAll&t=${Date.now()}`);
    const data = await response.json();
    
    console.log('ğŸ“Š Ø¨ÙŠØ§Ù†Ø§Øª GET:', data);
    
    if (data.status === 'success') {
      resultDiv.innerHTML = `
        <div class="text-green-600 font-bold">âœ… ØªÙ… Ø¬Ù„Ø¨ ${data.count || 0} Ø·Ù„Ø¨</div>
        <div class="text-gray-300 mt-2">
          <p>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${data.remaining || 0}</p>
          <p>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${data.lastUpdated || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</p>
        </div>
      `;
      
      // Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
      displayRecords(data.data || []);
    } else {
      resultDiv.innerHTML = `
        <div class="text-red-600 font-bold">âŒ ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
        <div class="text-gray-300">${data.message}</div>
      `;
    }
    
  } catch (error) {
    resultDiv.innerHTML = `
      <div class="text-red-600 font-bold">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</div>
      <div class="text-gray-300">${error.message}</div>
    `;
    console.error('âŒ Ø®Ø·Ø£ GET:', error);
  }
}

function displayRecords(records) {
  const recordsList = document.getElementById('records-list');
  
  if (!records || records.length === 0) {
    recordsList.innerHTML = '<div class="text-gray-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</div>';
    return;
  }
  
  let html = '<div class="space-y-2">';
  records.slice(0, 10).forEach(record => {
    html += `
      <div class="bg-slate-700 p-3 rounded-lg">
        <div class="font-bold">${record.name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
        <div class="text-xs text-gray-300">${record.email || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø±ÙŠØ¯'}</div>
        <div class="text-xs text-gray-400">${record.phone || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù…'}</div>
      </div>
    `;
  });
  
  if (records.length > 10) {
    html += `<div class="text-center text-gray-400">Ùˆ ${records.length - 10} Ø·Ù„Ø¨ Ø¥Ø¶Ø§ÙÙŠ</div>`;
  }
  
  html += '</div>';
  recordsList.innerHTML = html;
}

// ============================================
// Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¨Ø§Ø´Ø± Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
// ============================================
document.addEventListener('DOMContentLoaded', function() {
  console.log('ğŸš€ Ø§Ù„ØµÙØ­Ø© Ø¬Ø§Ù‡Ø²Ø©');
  console.log('ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø³ÙƒØ±Ø¨ÙŠØª:', SCRIPT_URL);
  
  // Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠ
  setTimeout(testScript, 1000);
  
  // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªØµØ­ÙŠØ­
  document.getElementById('debug-info').innerHTML = `
    <div>ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø³ÙƒØ±Ø¨ÙŠØª: ${SCRIPT_URL}</div>
    <div>ğŸ•’ ÙˆÙ‚Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„: ${new Date().toLocaleTimeString()}</div>
    <div>ğŸŒ Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${window.location.href}</div>
  `;
});

// ============================================
// Ø¯Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø¯ÙŠÙ„Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… JSONP
// ============================================
function testWithJsonp() {
  const script = document.createElement('script');
  script.src = `${SCRIPT_URL}?action=test&callback=handleJsonpResponse`;
  document.head.appendChild(script);
}

window.handleJsonpResponse = function(data) {
  console.log('ğŸ“¡ Ø§Ø³ØªØ¬Ø§Ø¨Ø© JSONP:', data);
  alert(`JSONP Response: ${JSON.stringify(data)}`);
  document.getElementById('test-result').innerHTML = 
    `<div class="text-green-600">JSONP: ${data.message}</div>`;
};
</script>

</body>
</html>
