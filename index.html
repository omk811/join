<!DOCTYPE html>
<html lang="ar" dir="rtl" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© - Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&family=Almarai:wght@300;400;700;800&display=swap" rel="stylesheet">
  
  <style>
    * { 
      font-family: 'Almarai', 'Tajawal', sans-serif; 
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body { 
      background: linear-gradient(135deg, #f0fdf4 0%, #e0f2fe 100%); 
      min-height: 100vh; 
    }
    
    .glass-card { 
      background: rgba(255, 255, 255, 0.85); 
      backdrop-filter: blur(12px); 
      border: 1px solid rgba(255, 255, 255, 0.6); 
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
    }
    
    .input-field { 
      width: 100%; 
      padding: 1rem 1rem 1rem 1rem; 
      border: 2px solid #e5e7eb; 
      border-radius: 1rem; 
      transition: all 0.3s ease;
      font-size: 1rem;
    }
    
    .input-field:focus { 
      border-color: #10b981; 
      box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1); 
      outline: none; 
    }
    
    .btn {
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .animate-slide-in {
      animation: slideIn 0.5s ease-out;
    }
  </style>
</head>
<body class="antialiased">

<main class="min-h-screen py-6 px-4 flex justify-center">
  <div class="w-full max-w-3xl">
    
    <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <header class="text-center mb-10 animate-slide-in">
      <div class="inline-block bg-gradient-to-r from-green-500 to-blue-500 text-white px-6 py-2 rounded-full mb-4">
        âœ¨ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ…
      </div>
      <h1 class="text-4xl md:text-5xl font-black text-gray-800 mb-2">Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</h1>
      <p class="text-lg text-gray-600">Ø¨ÙŠØ¦Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© ØªÙØ§Ø¹Ù„ÙŠØ© Ù„Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³</p>
    </header>

    <!-- Ø²Ø± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹ -->
    <div class="mb-6 animate-slide-in">
      <button onclick="testScript()" class="btn bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-xl font-bold w-full md:w-auto">
        ğŸ”§ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙƒØ±Ø¨ÙŠØª
      </button>
      <div id="test-result" class="glass-card p-4 rounded-xl text-sm mt-4 min-h-[80px]"></div>
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
    <div id="form-container" class="animate-slide-in">
      <form id="join-form" class="glass-card rounded-3xl p-6 md:p-8 space-y-5">
        
        <div class="text-center mb-4">
          <h2 class="text-2xl font-bold text-gray-800">ğŸ“ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</h2>
          <p class="text-gray-600 text-sm mt-2">Ø§Ù…Ù„Ø£ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹</p>
        </div>

        <!-- Ø§Ù„Ø§Ø³Ù… -->
        <div>
          <label for="name" class="block text-sm font-bold text-gray-700 mb-1.5">
            ğŸ‘¤ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ <span class="text-red-500">*</span>
          </label>
          <input 
            type="text" 
            id="name" 
            name="name"
            required 
            minlength="3"
            maxlength="100"
            class="input-field" 
            placeholder="Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø³Ø§Ù„Ù…"
            autocomplete="name"
          >
          <p class="text-xs text-gray-500 mt-1">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ ÙƒØ§Ù…Ù„Ø§Ù‹</p>
        </div>

        <!-- Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ -->
        <div>
          <label for="email" class="block text-sm font-bold text-gray-700 mb-1.5">
            ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ <span class="text-red-500">*</span>
          </label>
          <input 
            type="email" 
            id="email" 
            name="email"
            required 
            class="input-field" 
            placeholder="Ù…Ø«Ø§Ù„: name@example.com"
            autocomplete="email"
          >
          <p class="text-xs text-gray-500 mt-1">Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯</p>
        </div>

        <!-- Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ -->
        <div>
          <label for="phone" class="block text-sm font-bold text-gray-700 mb-1.5">
            ğŸ“± Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ <span class="text-red-500">*</span>
          </label>
          <input 
            type="tel" 
            id="phone" 
            name="phone"
            required 
            pattern="[0-9]{8}" 
            minlength="8"
            maxlength="8"
            class="input-field" 
            placeholder="Ù…Ø«Ø§Ù„: 99123456"
            autocomplete="tel"
          >
          <p class="text-xs text-gray-500 mt-1">Ø£Ø¯Ø®Ù„ 8 Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø· (Ø¨Ø¯ÙˆÙ† Ø§Ù„ØµÙØ± Ø§Ù„Ø£ÙˆÙ„)</p>
        </div>

        <!-- Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) -->
        <div>
          <label for="governorate" class="block text-sm font-bold text-gray-700 mb-1.5">
            ğŸ›ï¸ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©
          </label>
          <select id="governorate" name="governorate" class="input-field">
            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©...</option>
            <option value="Ù…Ø³Ù‚Ø·">Ù…Ø³Ù‚Ø·</option>
            <option value="Ø¸ÙØ§Ø±">Ø¸ÙØ§Ø±</option>
            <option value="Ù…Ø³Ù†Ø¯Ù…">Ù…Ø³Ù†Ø¯Ù…</option>
            <option value="Ø§Ù„Ø¨Ø±ÙŠÙ…ÙŠ">Ø§Ù„Ø¨Ø±ÙŠÙ…ÙŠ</option>
            <option value="Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©">Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©</option>
            <option value="Ø´Ù…Ø§Ù„ Ø§Ù„Ø¨Ø§Ø·Ù†Ø©">Ø´Ù…Ø§Ù„ Ø§Ù„Ø¨Ø§Ø·Ù†Ø©</option>
            <option value="Ø¬Ù†ÙˆØ¨ Ø§Ù„Ø¨Ø§Ø·Ù†Ø©">Ø¬Ù†ÙˆØ¨ Ø§Ù„Ø¨Ø§Ø·Ù†Ø©</option>
            <option value="Ø¬Ù†ÙˆØ¨ Ø§Ù„Ø´Ø±Ù‚ÙŠØ©">Ø¬Ù†ÙˆØ¨ Ø§Ù„Ø´Ø±Ù‚ÙŠØ©</option>
            <option value="Ø´Ù…Ø§Ù„ Ø§Ù„Ø´Ø±Ù‚ÙŠØ©">Ø´Ù…Ø§Ù„ Ø§Ù„Ø´Ø±Ù‚ÙŠØ©</option>
            <option value="Ø§Ù„Ø¸Ø§Ù‡Ø±Ø©">Ø§Ù„Ø¸Ø§Ù‡Ø±Ø©</option>
            <option value="Ø§Ù„ÙˆØ³Ø·Ù‰">Ø§Ù„ÙˆØ³Ø·Ù‰</option>
          </select>
        </div>

        <!-- Ø§Ù„ÙˆÙ„Ø§ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) -->
        <div>
          <label for="wilayat" class="block text-sm font-bold text-gray-700 mb-1.5">
            ğŸ“ Ø§Ù„ÙˆÙ„Ø§ÙŠØ©
          </label>
          <input 
            type="text" 
            id="wilayat" 
            name="wilayat"
            class="input-field" 
            placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø³ÙŠØ¨"
            maxlength="50"
          >
        </div>

        <!-- Ø§Ù„Ù…Ø¯Ø±Ø³Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) -->
        <div>
          <label for="school" class="block text-sm font-bold text-gray-700 mb-1.5">
            ğŸ« Ø§Ù„Ù…Ø¯Ø±Ø³Ø©
          </label>
          <input 
            type="text" 
            id="school" 
            name="school"
            class="input-field" 
            placeholder="Ù…Ø«Ø§Ù„: Ù…Ø¯Ø±Ø³Ø© Ø³Ø¹Ø¯ Ø¨Ù† Ù…Ø¹Ø§Ø°"
            maxlength="100"
          >
        </div>

        <!-- Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ -->
        <button 
          type="submit" 
          id="submit-btn" 
          class="btn bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white w-full py-4 rounded-xl font-bold text-lg shadow-lg"
        >
          âœ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…
        </button>

        <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„Ø© -->
        <div id="form-status" class="hidden p-4 rounded-xl text-center font-bold"></div>
      </form>
    </div>

    <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ -->
    <div id="success-message" class="hidden glass-card rounded-3xl p-8 text-center animate-slide-in">
      <div class="text-6xl mb-4">ğŸ‰</div>
      <h2 class="text-3xl font-bold text-green-600 mb-2">ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!</h2>
      <p class="text-gray-600 mb-6">Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ! Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹.</p>
      <button onclick="resetForm()" class="btn bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-xl font-bold">
        ğŸ“ Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø¢Ø®Ø±
      </button>
    </div>

    <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ† -->
    <footer class="mt-10 text-center">
      <button onclick="openSimpleAdmin()" class="btn bg-gray-800 hover:bg-gray-900 text-white px-4 py-2 rounded-full text-sm">
        ğŸ” Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†
      </button>
    </footer>

  </div>
</main>

<!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ† -->
<div id="simple-admin" class="hidden fixed inset-0 bg-slate-900 p-4 z-50 overflow-auto">
  <div class="max-w-5xl mx-auto">
    
    <!-- Ø±Ø£Ø³ Ø§Ù„Ù„ÙˆØ­Ø© -->
    <div class="flex justify-between items-center mb-6 bg-slate-800 p-4 rounded-xl">
      <h2 class="text-2xl font-bold text-white">ğŸ›ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
      <button onclick="closeSimpleAdmin()" class="btn bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg">
        âœ• Ø¥ØºÙ„Ø§Ù‚
      </button>
    </div>
    
    <!-- Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ… -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
      
      <!-- Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ -->
      <div class="bg-slate-800 p-4 rounded-xl">
        <h3 class="text-white font-bold mb-3 text-lg">ğŸ”§ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</h3>
        <button onclick="adminTestConnection()" class="btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg w-full mb-2">
          Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³ÙƒØ±Ø¨ÙŠØª
        </button>
        <button onclick="testGetAll()" class="btn bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg w-full mb-2">
          Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        </button>
        <div id="admin-test-result" class="text-white text-sm mt-2 p-2 bg-slate-700 rounded-lg min-h-[60px]"></div>
      </div>
      
      <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
      <div class="bg-slate-800 p-4 rounded-xl">
        <h3 class="text-white font-bold mb-3 text-lg">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h3>
        <div id="stats-container" class="space-y-2">
          <div class="bg-slate-700 p-3 rounded-lg text-white">
            <div class="text-sm text-gray-400">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
            <div id="total-count" class="text-2xl font-bold">-</div>
          </div>
          <div class="bg-slate-700 p-3 rounded-lg text-white">
            <div class="text-sm text-gray-400">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</div>
            <div id="remaining-count" class="text-2xl font-bold">-</div>
          </div>
        </div>
      </div>
      
    </div>
    
    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
    <div class="bg-slate-800 p-4 rounded-xl mb-6">
      <div class="flex justify-between items-center mb-3">
        <h3 class="text-white font-bold text-lg">ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
        <button onclick="testGetAll()" class="btn bg-purple-500 hover:bg-purple-600 text-white px-3 py-1 rounded-lg text-sm">
          ğŸ”„ ØªØ­Ø¯ÙŠØ«
        </button>
      </div>
      <div id="records-list" class="text-white text-sm max-h-96 overflow-y-auto"></div>
    </div>
    
    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­ -->
    <div class="bg-slate-800 p-4 rounded-xl">
      <h3 class="text-white font-bold mb-3 text-lg">ğŸ› Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­</h3>
      <div id="debug-info" class="text-yellow-300 text-xs font-mono bg-slate-900 p-3 rounded-lg overflow-x-auto"></div>
    </div>
    
  </div>
</div>

<script>
// ============================================
// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„
// ============================================
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwBPFWhdR1r1T78ozhHem-rBg3L0zRU7XRTqZ8zZbVMZzGacPadTeS6S-PBf0d7DhFX/exec';

// Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
let isSubmitting = false;

// ============================================
// Ø¯Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„
// ============================================
async function testScript() {
  const resultDiv = document.getElementById('test-result');
  resultDiv.innerHTML = '<div class="text-blue-500 animate-pulse">â³ Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„...</div>';
  
  try {
    console.log('ğŸ” Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„...');
    console.log('ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø³ÙƒØ±Ø¨ÙŠØª:', SCRIPT_URL);
    
    const url = `${SCRIPT_URL}?action=test&t=${Date.now()}`;
    console.log('ğŸ“¤ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„ÙƒØ§Ù…Ù„:', url);
    
    const response = await fetch(url, {
      method: 'GET',
      headers: {
        'Accept': 'application/json'
      }
    });
    
    console.log('ğŸ“¡ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©:', response.status);
    console.log('ğŸ“¡ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰:', response.headers.get('content-type'));
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const data = await response.json();
    console.log('âœ… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©:', data);
    
    resultDiv.innerHTML = `
      <div class="text-green-600 font-bold text-lg mb-2">âœ… Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­!</div>
      <div class="text-gray-700 space-y-1 text-sm">
        <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${data.status}</p>
        <p><strong>Ø§Ù„Ø±Ø³Ø§Ù„Ø©:</strong> ${data.message}</p>
        <p><strong>Ø§Ù„Ø¥ØµØ¯Ø§Ø±:</strong> ${data.version || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</p>
        <p><strong>Ø§Ù„ÙˆÙ‚Øª:</strong> ${new Date(data.timestamp).toLocaleString('ar-SA')}</p>
      </div>
    `;
    
    return true;
    
  } catch (error) {
    console.error('âŒ Ø®Ø·Ø£ Ø§Ù„Ø§ØªØµØ§Ù„:', error);
    
    resultDiv.innerHTML = `
      <div class="text-red-600 font-bold text-lg mb-2">âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„!</div>
      <div class="text-gray-700 space-y-2 text-sm">
        <p><strong>Ø§Ù„Ø®Ø·Ø£:</strong> ${error.message}</p>
        <div class="bg-yellow-50 p-3 rounded-lg mt-3">
          <p class="font-bold mb-2">ØªØ­Ù‚Ù‚ Ù…Ù†:</p>
          <ol class="list-decimal pr-4 space-y-1">
            <li>ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ø³ÙƒØ±Ø¨ÙŠØª Ù…Ù†Ø´ÙˆØ± ÙƒÙ€ "Anyone, even anonymous"</li>
            <li>ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø±Ø§Ø¨Ø· Ø§Ù„Ø³ÙƒØ±Ø¨ÙŠØª</li>
            <li>ØªØ£ÙƒØ¯ Ù…Ù† Ù†Ø´Ø± Ø¢Ø®Ø± Ù†Ø³Ø®Ø© Ù…Ù† Ø§Ù„Ø³ÙƒØ±Ø¨ÙŠØª</li>
            <li>Ø§ÙØªØ­ Console (F12) Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„</li>
          </ol>
        </div>
      </div>
    `;
    
    return false;
  }
}

// ============================================
// Ù…Ø¹Ø§Ù„Ø¬Ø© Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
// ============================================
document.getElementById('join-form').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  if (isSubmitting) {
    console.log('âš ï¸ ÙŠØªÙ… Ø¨Ø§Ù„ÙØ¹Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨');
    return;
  }
  
  const submitBtn = document.getElementById('submit-btn');
  const formStatus = document.getElementById('form-status');
  const originalText = submitBtn.textContent;
  
  // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø± ÙˆØªØºÙŠÙŠØ± Ø§Ù„Ù†Øµ
  isSubmitting = true;
  submitBtn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
  submitBtn.disabled = true;
  formStatus.classList.add('hidden');
  
  // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  const formData = {
    action: 'create',
    name: document.getElementById('name').value.trim(),
    email: document.getElementById('email').value.trim(),
    phone: document.getElementById('phone').value.trim(),
    governorate: document.getElementById('governorate').value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
    wilayat: document.getElementById('wilayat').value.trim() || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
    school: document.getElementById('school').value.trim() || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
    submitted_at: new Date().toISOString()
  };
  
  console.log('ğŸ“¤ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©:', formData);
  
  try {
    const response = await fetch(SCRIPT_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'text/plain;charset=utf-8'
      },
      body: JSON.stringify(formData)
    });
    
    console.log('ğŸ“¡ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©:', response.status);
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const result = await response.json();
    console.log('ğŸ“¥ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©:', result);
    
    if (result.status === 'success') {
      // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
      document.getElementById('form-container').classList.add('hidden');
      document.getElementById('success-message').classList.remove('hidden');
      
      console.log('âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­');
    } else {
      // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£
      formStatus.innerHTML = `âŒ ${result.message}`;
      formStatus.className = 'p-4 rounded-xl text-center font-bold bg-red-100 text-red-700';
      formStatus.classList.remove('hidden');
    }
    
  } catch (error) {
    console.error('âŒ Ø®Ø·Ø£ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„:', error);
    
    formStatus.innerHTML = `âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…: ${error.message}<br><small>ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆÙ†Ø³ÙˆÙ„ (F12) Ù„Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„</small>`;
    formStatus.className = 'p-4 rounded-xl text-center font-bold bg-red-100 text-red-700';
    formStatus.classList.remove('hidden');
    
  } finally {
    isSubmitting = false;
    submitBtn.textContent = originalText;
    submitBtn.disabled = false;
  }
});

// ============================================
// Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
// ============================================
function resetForm() {
  document.getElementById('join-form').reset();
  document.getElementById('form-container').classList.remove('hidden');
  document.getElementById('success-message').classList.add('hidden');
  document.getElementById('form-status').classList.add('hidden');
}

// ============================================
// Ø¯Ø§Ù„Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†
// ============================================
function openSimpleAdmin() {
  document.getElementById('simple-admin').classList.remove('hidden');
  document.body.style.overflow = 'hidden';
  updateDebugInfo();
}

function closeSimpleAdmin() {
  document.getElementById('simple-admin').classList.add('hidden');
  document.body.style.overflow = 'auto';
}

async function adminTestConnection() {
  const resultDiv = document.getElementById('admin-test-result');
  resultDiv.innerHTML = '<div class="text-blue-500 animate-pulse">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...</div>';
  
  try {
    const response = await fetch(`${SCRIPT_URL}?action=test&t=${Date.now()}`);
    const data = await response.json();
    
    resultDiv.innerHTML = `
      <div class="text-green-400 font-bold">âœ… Ù…ØªØµÙ„</div>
      <div class="text-gray-300 text-xs mt-1">${data.message}</div>
    `;
    
  } catch (error) {
    resultDiv.innerHTML = `
      <div class="text-red-400 font-bold">âŒ Ø®Ø·Ø£</div>
      <div class="text-gray-300 text-xs mt-1">${error.message}</div>
    `;
  }
}

async function testGetAll() {
  const resultDiv = document.getElementById('admin-test-result');
  const statsTotal = document.getElementById('total-count');
  const statsRemaining = document.getElementById('remaining-count');
  
  resultDiv.innerHTML = '<div class="text-blue-400 animate-pulse">â³ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>';
  
  try {
    const response = await fetch(`${SCRIPT_URL}?action=getAll&t=${Date.now()}`);
    const data = await response.json();
    
    console.log('ğŸ“Š Ø¨ÙŠØ§Ù†Ø§Øª GET:', data);
    
    if (data.status === 'success') {
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
      statsTotal.textContent = data.count || 0;
      statsRemaining.textContent = data.remaining || 0;
      
      resultDiv.innerHTML = `
        <div class="text-green-400 font-bold">âœ… ØªÙ… Ø¬Ù„Ø¨ ${data.count || 0} Ø·Ù„Ø¨</div>
        <div class="text-gray-300 text-xs mt-1">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${new Date(data.lastUpdated).toLocaleString('ar-SA')}</div>
      `;
      
      // Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
      displayRecords(data.data || []);
    } else {
      resultDiv.innerHTML = `
        <div class="text-red-400 font-bold">âŒ ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
        <div class="text-gray-300 text-xs">${data.message}</div>
      `;
      displayRecords([]);
    }
    
  } catch (error) {
    resultDiv.innerHTML = `
      <div class="text-red-400 font-bold">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</div>
      <div class="text-gray-300 text-xs">${error.message}</div>
    `;
    console.error('âŒ Ø®Ø·Ø£ GET:', error);
    displayRecords([]);
  }
}

function displayRecords(records) {
  const recordsList = document.getElementById('records-list');
  
  if (!records || records.length === 0) {
    recordsList.innerHTML = `
      <div class="text-center text-gray-400 py-8">
        <div class="text-4xl mb-2">ğŸ“­</div>
        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>
      </div>
    `;
    return;
  }
  
  let html = '<div class="space-y-3">';
  
  records.forEach((record, index) => {
    html += `
      <div class="bg-slate-700 p-4 rounded-lg hover:bg-slate-600 transition-colors">
        <div class="flex justify-between items-start mb-2">
          <div class="font-bold text-lg">${record['Ø§Ù„Ø§Ø³Ù…'] || record.name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
          <div class="text-xs text-gray-400">#${index + 1}</div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
          <div class="text-gray-300">
            <span class="text-gray-400">ğŸ“§</span> ${record['Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ'] || record.email || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}
          </div>
          <div class="text-gray-300">
            <span class="text-gray-400">ğŸ“±</span> ${record['Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ'] || record.phone || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}
          </div>
          <div class="text-gray-300">
            <span class="text-gray-400">ğŸ›ï¸</span> ${record['Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©'] || record.governorate || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
          </div>
          <div class="text-gray-300">
            <span class="text-gray-400">ğŸ“</span> ${record['Ø§Ù„ÙˆÙ„Ø§ÙŠØ©'] || record.wilayat || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
          </div>
          <div class="text-gray-300 md:col-span-2">
            <span class="text-gray-400">ğŸ«</span> ${record['Ø§Ù„Ù…Ø¯Ø±Ø³Ø©'] || record.school || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
          </div>
          <div class="text-gray-400 text-xs md:col-span-2">
            <span class="text-gray-500">â°</span> ${formatDate(record['ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„'] || record.submitted_at)}
          </div>
        </div>
      </div>
    `;
  });
  
  html += '</div>';
  recordsList.innerHTML = html;
}

function formatDate(dateString) {
  if (!dateString) return 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
  
  try {
    const date = new Date(dateString);
    return date.toLocaleString('ar-SA', {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });
  } catch (error) {
    return dateString;
  }
}

function updateDebugInfo() {
  const debugDiv = document.getElementById('debug-info');
  debugDiv.innerHTML = `
    <div class="space-y-1">
      <div>ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø³ÙƒØ±Ø¨ÙŠØª: ${SCRIPT_URL}</div>
      <div>ğŸ•’ ÙˆÙ‚Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„: ${new Date().toLocaleString('ar-SA')}</div>
      <div>ğŸŒ Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${window.location.href}</div>
      <div>ğŸ“± Ø§Ù„Ù…ØªØµÙØ­: ${navigator.userAgent}</div>
      <div>ğŸ–¥ï¸ Ø§Ù„Ø´Ø§Ø´Ø©: ${window.innerWidth}x${window.innerHeight}</div>
    </div>
  `;
}

// ============================================
// Ø§Ø®ØªØ¨Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
// ============================================
document.addEventListener('DOMContentLoaded', function() {
  console.log('ğŸš€ Ø§Ù„ØµÙØ­Ø© Ø¬Ø§Ù‡Ø²Ø©');
  console.log('ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø³ÙƒØ±Ø¨ÙŠØª:', SCRIPT_URL);
  console.log('â° Ø§Ù„ÙˆÙ‚Øª:', new Date().toLocaleString('ar-SA'));
  
  // Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ©
  setTimeout(() => {
    testScript();
  }, 1000);
  
  // Ù…Ù†Ø¹ Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¹Ù†Ø¯ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©
  if (window.history.replaceState) {
    window.history.replaceState(null, null, window.location.href);
  }
});

// Ù…Ù†Ø¹ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…ØªÙƒØ±Ø±
window.addEventListener('beforeunload', function() {
  if (isSubmitting) {
    return 'ÙŠØªÙ… Ø­Ø§Ù„ÙŠØ§Ù‹ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø©ØŸ';
  }
});
</script>

</body>
</html>
